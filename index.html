
<!doctype html>
<html>
<head>
    <title>Example Domain</title>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type="text/css">
    </style>    
</head>

<body>
<div>
    <button onclick="onGetManagerClick()">getManager</button>
    <button onclick="onGetCitiesClick()">getCities</button>
    <button onclick="onGetCityClick()">getCity</button>
    <button onclick="onGetCityCountClick()">getCityCount</button>
    <button onclick="onMoveClick()">move</button>
</div>
<script src="./js/nebPay.js"></script>
<script>

    var contractAddress = "n1yWQyiYszz5rMbBaXZz4mfXKVoFaQhUuBA"
    function onGetManagerClick() {
        var func = "getManager"
        var args = "[]"

        window.postMessage({
            "target": "contentscript",
            "data": {
                "to": contractAddress,
                "value": "0",
                "contract": {
                    "function": func,
                    "args": args
                }
            },
            "method": "neb_call"
        }, "*");
    }

    function onGetCitiesClick() {
        var func = "getCities"
        var args = "[]"

        window.postMessage({
            "target": "contentscript",
            "data": {
                "to": contractAddress,
                "value": "0",
                "contract": {
                    "function": func,
                    "args": args
                }
            },
            "method": "neb_call"
        }, "*");
    }

    function onGetCityClick() {
        var func = "getCity"
        var args = "[1]"

        window.postMessage({
            "target": "contentscript",
            "data": {
                "to": contractAddress,
                "value": "0",
                "contract": {
                    "function": func,
                    "args": args
                }
            },
            "method": "neb_call"
        }, "*");
    }

    function onGetCityCountClick() {
        var func = "getCityCount"
        var args = "[]"

        window.postMessage({
            "target": "contentscript",
            "data": {
                "to": contractAddress,
                "value": "0",
                "contract": {
                    "function": func,
                    "args": args
                }
            },
            "method": "neb_call"
        }, "*");
    }

    function onMoveClick() {
        var func = "getMyPosition"
        var args = "[]"

        window.postMessage({
            "target": "contentscript",
            "data": {
                "to": contractAddress,
                "value": "0",
                "contract": {
                    "function": func,
                    "args": args
                }
            },
            "method": "neb_call"
        }, "*");
    }

    window.addEventListener('message', function (e) {
        try {
            var getResults = e.data.data.neb_call.result;

            if (getResults === "null") {
                console.log(getResults);
            }

            if (getResults !== "null") {
                try {
                    //getResults = JSON.parse(e.data.data.neb_call.result)
                    console.log(getResults);

                } catch (e) {
                    if (e == undefined) {
                        console.log(`results were undefined`);
                    }
                }
            }
        } catch (e) {
            if (e == undefined) {
                console.log(`results were undefined`);
            }
        }
    })

</script>

</body>
</html>
